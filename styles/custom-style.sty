% Las configuraciones están organizadas por áreas sin un orden especifico
% pero algunas opciones impactan varias secciones
% Modificar el orden de alguna seccion o paquetes puede causar errores

\NeedsTeXFormat{LaTeX2e} % verificacion de compatibilidad
% ============================================================
% 0-Paquetes
  % Codificación y lenguaje
    \RequirePackage[utf8]{inputenc}
    \RequirePackage[T1]{fontenc}
    \RequirePackage[spanish]{babel}
    \RequirePackage{csquotes}
  
  % Tipografía y fuentes
    \RequirePackage{arev}
    \RequirePackage[sfdefault]{roboto}
    \RequirePackage{mathpazo}
    \RequirePackage{yfonts}
  
  % Matemáticas
    \RequirePackage{amsmath}
    \RequirePackage{amssymb}
    \RequirePackage{amsfonts}
    \RequirePackage{amsthm}
    \RequirePackage{mathtools}
  
  % Tablas
    \RequirePackage{array}
    \RequirePackage{booktabs}
    \RequirePackage{colortbl}
    \RequirePackage{longtable}
  
  % Figuras y gráficos
    \RequirePackage{graphicx}
    \RequirePackage{subcaption}
    \RequirePackage{float}
    \RequirePackage{tikz}
    \usetikzlibrary{calc, angles, quotes, arrows.meta}
    \tikzset{ 
      every picture/.style={
        line width=1pt,
        fill=orange,
        draw=violet,
        text=blue,
      },
      >={Stealth[length=6pt,inset=2pt]}
    }
  
  % Estilo de documento y encabezados
    \RequirePackage{fancyhdr}
    \RequirePackage{titlesec}
    \RequirePackage{tocloft}
    \RequirePackage{caption}
  
  % Marcos y cajas
    \RequirePackage{framed}
    \RequirePackage{mdframed}
    \RequirePackage[most,many]{tcolorbox}
  
  % Código y color
    \RequirePackage{listings}
    \RequirePackage{xcolor}
    \RequirePackage{pagecolor}
  
  % Margenes y disposición
    \RequirePackage[left=1cm,right=1cm,top=1.5cm,bottom=1.5cm]{geometry}
    \RequirePackage{chngcntr}
    \RequirePackage[bottom, hang]{footmisc}
  
  % Glosarios
    \RequirePackage[
      acronym,
      symbols,
      nonumberlist,
      nogroupskip,
      nomain,
      toc,
      section=chapter,
      style=long,
    ]{glossaries}
  
  % Bibliografía
    \RequirePackage[
      style=apa,
      backend=biber,
      citestyle=authortitle,
      sorting=nyt,
      doi=true,
      isbn=true,
      url=true
    ]{biblatex}
  
  % Otros
    \RequirePackage{eso-pic}       % Insertar contenido(como imágenes o texto)la página.
    \RequirePackage{bookmark}      % Mejora hyperref, permite una estructura limpia y personalizable del índice del PDF.
    \RequirePackage{wallpaper}     % Insertar imágenes como fondo de página
    \RequirePackage{epigraph}      % Epigrafe
    \RequirePackage[absolute,overlay]{textpos} % Posicionar texto u objetos en coordenadas absolutas
    \RequirePackage{appendix}      % Apéndices
    \RequirePackage{pifont}        % Símbolos especiales para listas o resaltado visual.
    \RequirePackage{hyperref}      % Hipervínculos



% ============================================================
% 1-Colores (Colores de codigo estan abajo)
   % Hay colores predefinidos que se pueden usar directamente:
   % black, white, red, green, blue, cyan, magenta, yellow,
   % gray, brown, lime, olive, orange,
   % pink, purple, teal, violet.
   % ==============================
   % 2.2.1 Colorbox
     % =======
     % 2.2.1.1 Observación/Nota
      \definecolor{ObservationYellow}{RGB}{204,153,0}
     % =======
     % 2.2.1.2 Ejercicio
      \definecolor{ExerciseBlue}{RGB}{51,102,204}         % base
      \definecolor{ExerciseBlueLight}{RGB}{220,230,255}   % fondo suave
      \definecolor{ExerciseBlueDark}{RGB}{30,60,150}      % borde / título
      \definecolor{ExerciseAccent}{RGB}{20,40,120}        % detalles / overlay
     % =======
     % 2.2.1.3 Solución
      \definecolor{SolutionBlue}{RGB}{102,153,204}      % base 
      \definecolor{SolutionBlueLight}{RGB}{187,212,235} % fondo suave
      \definecolor{SolutionBlueDark}{RGB}{51,102,153}   % título y borde intensos
      \definecolor{SolutionAccent}{RGB}{0,102,153}      % detalles / overlay
     % =======
     % 2.2.1.4 Definición
      \definecolor{DefinitionTeal}{RGB}{0,153,153}         % base
      \definecolor{DefinitionTealLight}{RGB}{204,255,255}  % fondo suave
      \definecolor{DefinitionTealDark}{RGB}{0,102,102}     % título y borde intensos
      \definecolor{DefinitionAccent}{RGB}{0,77,77}         % detalles / overlay   
     % =======
     % 2.2.1.5 Ejemplo
      \definecolor{ExampleTurquoise}{RGB}{0,204,204}        % base
      \definecolor{ExampleTurquoiseLight}{RGB}{204,255,255} % fondo suave
      \definecolor{ExampleTurquoiseDark}{RGB}{0,153,153}    % borde / título
      \definecolor{ExampleAccent}{RGB}{0,102,102}           % detalles / overlay
     % =======
     % 2.2.1.6 Teorema
      \definecolor{TheoremRed}{RGB}{153,0,51}             % base
      \definecolor{TheoremRedLight}{RGB}{255,204,221}     % fondo suave
      \definecolor{TheoremRedDark}{RGB}{102,0,34}         % borde / título
      \definecolor{TheoremAccent}{RGB}{77,0,26}           % detalles / overlay        
     % =======
     % 2.2.1.7 Actividad
      \definecolor{ActivityOrange}{RGB}{255,102,0}        % base
      \definecolor{ActivityOrangeLight}{RGB}{255,204,153} % fondo suave
      \definecolor{ActivityOrangeDark}{RGB}{204,82,0}     % título y borde intensos
      \definecolor{ActivityAccent}{RGB}{153,51,0}         % detalles / overlay
     % =======
     % 2.2.1.8 Generalidad
      \definecolor{GeneralityGray}{RGB}{153,153,153}      % base
      \definecolor{GeneralityGrayLight}{RGB}{230,230,230} % fondo suave
      \definecolor{GeneralityGrayDark}{RGB}{50,50,50}  % borde / título
      \definecolor{GeneralityAccent}{RGB}{51,51,51}       % detalles / overlay
     % =======
     % 2.2.1.9 Propiedad
      \definecolor{PropertyGreen}{RGB}{0,102,51}          % base
      \definecolor{PropertyGreenLight}{RGB}{204,255,229}  % fondo suave
      \definecolor{PropertyGreenDark}{RGB}{0,80,40}       % borde / título
      \definecolor{PropertyAccent}{RGB}{0,60,30}          % detalles / overlay
     % =======
     % 2.2.1.10 Resumen
      \definecolor{SummaryGray}{RGB}{85,85,85}            % base
      \definecolor{SummaryGrayLight}{RGB}{240,240,240}    % fondo suave
      \definecolor{SummaryGrayDark}{RGB}{60,60,60}        % borde / título
      \definecolor{SummaryAccent}{RGB}{50,50,50}          % detalles / overlay
     % =======
     % 2.2.1.11 Advertencia
      \definecolor{WarningOrange}{RGB}{255,140,0}         % base
      \definecolor{WarningOrangeLight}{RGB}{255,235,204}  % fondo suave
      \definecolor{WarningOrangeDark}{RGB}{180,90,0}      % borde / título
      \definecolor{WarningAccent}{RGB}{140,70,0}          % detalles / overlay
     % =======
     % 2.2.1.11 textbox
      %\definecolor{colback1}  {RGB}{50, 56, 68}
      %\definecolor{colframe1} {RGB}{120, 138, 182}
      

  

   % ===============
   % 2.2.2 Fondo/Texto
    %\definecolor{Backdoc}{RGB}{230, 230, 230}% Claro 
    \definecolor{Backdoc}{RGB}{36, 40, 48}   % Oscuro
    % Fondo obscuro
    %\definecolor{Text}  {RGB}{50, 50, 50}     % Claro 
    \definecolor{Text}   {RGB}{220, 220, 220} % Oscuro 
    


   % ===============
   % 2.2.3 Titulos
     
     % =======
     % =======
     % 2.2.3.1 Part 
     % Fondo obscuro
     \definecolor{Partcolor}{RGB}{40, 60, 100} 
     % Fondo claro
     %\definecolor{Partcolor}{RGB}{70, 100, 160}
     % Fondo versátil
     %\definecolor{Partcolor}{RGB}{60, 80, 120} 
     
     % =======
     % 2.2.3.1 Chapter
     % Fondo obscuro
     \definecolor{Chaptercolor}{RGB}{70, 50, 100} 
     % Fondo claro
     %\definecolor{Chaptercolor}{RGB}{120, 90, 180}
     % Fondo versátil
     %\definecolor{Chaptercolor}{RGB}{90, 70, 120}  
     
     % =======
     % 2.2.3.1 *Chapter
     % Fondo obscuro
     \definecolor{*chaptercolor}{RGB}{85, 85, 105} 
     % Fondo claro
     %\definecolor{*chaptercolor}{RGB}{140, 140, 180}
     % Fondo (versátil)
     %\definecolor{*chaptercolor}{RGB}{100, 100, 130} 
     
     
     % =======
     % 2.2.3.1 Section
     % Fondo obscuro
     \definecolor{Sectioncolor}{RGB}{60, 80, 60} 
     % Fondo claro
     %\definecolor{Sectioncolor}{RGB}{100, 130, 100}
     % Fondo versátil
     %\definecolor{Sectioncolor}{RGB}{70, 100, 70}
     
     % =======
     % 2.2.3.1 Subsection
     % Fondo obscuro
     \definecolor{Subsectioncolor}{RGB}{75, 75, 110} 
     % Fondo claro
     %\definecolor{Subsectioncolor}{RGB}{130, 130, 180}
     % Fondo versátil
     %\definecolor{Subsectioncolor}{RGB}{100, 100, 140}
     
     % =======
     % 2.2.3.1 Subsubsection
     % Fondo obscuro
      \definecolor{Subsubsectioncolor}{RGB}{70, 70, 90} 
     % Fondo claro
     %\definecolor{Subsubsectioncolor}{RGB}{150, 150, 170}
     % Fondo versátil
     %\definecolor{Subsubsectioncolor}{RGB}{120, 120, 150} 
   % ===============
   % 2.2.4 Matematicas
      \definecolor{softblue}{RGB}{70,130,180} % Steel Blue suave
   % ===============
   % 2.2.4 Link
    \definecolor{linkcolor1}{RGB}{180, 240, 255} % Azul aún más claro
    \definecolor{urlcolor1}{RGB}{144, 238, 144}    % verde claro (LightGreen)
    \definecolor{citecolor1}{RGB}{135, 206, 250}   % rosado claro (LightPink)
   

% ============================================================
% 2-Colorbox (las de codigo estan en la seccion de codigo)
  % ===============================
  % 3.1 Configuraciones
    \tcbset{
    colframe=magenta,                   % Color del borde
    colback=magenta!12!white,           % Color del fondo
    breakable,                          % Permite que la caja se divida en varias páginas
    enhanced,                           % Habilita características avanzadas
    % sharp corners,                    % se usa globalmente para bordes rectos
    boxsep=1pt,                         % Espacio entre contenido y borde
    attach boxed title to top left={     % Posiciona el título arriba a la izquierda
        yshift=-\tcboxedtitleheight,  
        yshifttext=-.75\baselineskip     % Ajuste vertical del texto
    },
    boxed title style={                 % Estilo para el título de la caja
        boxsep=1pt                       % Espacio entre el borde y el título
    },
    fonttitle=\bfseries\sffamily,       % Fuente del título en negrita y sans-serif
    %drop lifted shadow                  % Efecto de sombra levantada
    }
  
  % ===============================
  % 3.2 Definiciones de colorbox
   % ========
   % 3.2.1 Ejercicio
    \newtcolorbox[auto counter,number within=chapter,number format=\arabic]{exercise}[1][]{
     arc=4pt,
     title={Ejercicio },
     colframe=ExerciseBlueDark,
     colback=ExerciseBlueLight,
     coltitle=black,
     boxed title style={colback=ExerciseBlue},
     overlay unbroken and first={
         \node[below right,font=\small,color=ExerciseAccent,text width=.8\linewidth]
         at (title.north east) {#1};
     }
    }
   % ========
   % 3.2.2 Solution
    \newtcolorbox[auto counter,number within=chapter,number format=\arabic]{solution}[1][]{
     arc=4pt,
     title={Solución },
     colframe=SolutionBlueDark,
     colback=SolutionBlueLight,
     coltitle=white,
     boxed title style={colback=SolutionBlue},
     overlay unbroken and first={
         \node[below right,font=\small,color=SolutionAccent,text width=.8\linewidth]
         at (title.north east) {#1};
     }
     }
   % ========
   % 3.2.3 Definition

    \newtcolorbox[auto counter,number within=chapter,number format=\arabic]{definition}[1][]{
     arc=4pt,
     title={Definición },
     colframe=DefinitionTealDark,
     colback=DefinitionTealLight,
     coltitle=white,
     boxed title style={colback=DefinitionTeal},
     overlay unbroken and first={
         \node[below right,font=\small,color=DefinitionAccent,text width=.8\linewidth]
         at (title.north east) {#1};
     }
    } 
   % ========
   % 3.2.4 Example
    \newtcolorbox[auto counter,number within=chapter,number format=\arabic]{example}[1][]{
      arc=4pt,
      title={Ejemplo },
      colframe=ExampleTurquoiseDark,
      colback=ExampleTurquoiseLight,
      coltitle=black,
      boxed title style={colback=ExampleTurquoise},
      overlay unbroken and first={
          \node[below right,font=\small,color=ExampleAccent,text width=.8\linewidth]
          at (title.north east) {#1};
      }
     }
   %========
   % 3.2.6 Theorem
    \newtcolorbox[auto counter,number within=chapter,number format=\arabic]{theorem}[1][]{
     arc=4pt,
     title={Teorema},
     colframe=TheoremRedDark,
     colback=TheoremRedLight,
     coltitle=white,
     boxed title style={colback=TheoremRed},
     overlay unbroken and first={
         \node[below right,font=\small,color=TheoremAccent,text width=.8\linewidth]
         at (title.north east) {#1};
     }
    }

   %========
   % 3.2.7 Activity
    \newtcolorbox[auto counter,number within=chapter,number format=\arabic]{activity}[1][]{
     arc=4pt,
     title={Actividad },
     colframe=ActivityOrangeDark,
     colback=ActivityOrangeLight,
     coltitle=white,
     boxed title style={colback=ActivityOrange},
     overlay unbroken and first={
         \node[below right,font=\small,color=ActivityAccent,text width=.8\linewidth]
         at (title.north east) {#1};
     }
    }
   %========
   % 3.2.8 Generality
    \newtcolorbox[auto counter,number within=chapter,number format=\arabic]{generality}[1][]{
     arc=4pt,
     title={Generalidad},
     colframe=GeneralityGrayDark,
     colback=GeneralityGrayLight,
     coltitle=black,
     boxed title style={colback=GeneralityGray},
     overlay unbroken and first={
         \node[below right,font=\small,color=GeneralityAccent,text width=.8\linewidth]
         at (title.north east) {#1};
     }
    }

   %========
   % 3.2.9 Property
    \newtcolorbox[auto counter,number within=chapter,number format=\arabic]{property}[1][]{
     arc=4pt,
     title={Propiedad},
     colframe=PropertyGreenDark,
     colback=PropertyGreenLight,
     coltitle=black,
     boxed title style={colback=PropertyGreen},
     overlay unbroken and first={
         \node[below right,font=\small,color=PropertyAccent,text width=.8\linewidth]
         at (title.north east) {#1};
     }
    }
   %========
   % 3.2.10 Resumen
    \newtcolorbox[auto counter,number within=chapter,number format=\arabic]{summary}[1][]{
     arc=4pt,
     title={\textbf{Resumen}},
     colframe=SummaryGrayDark,
     colback=SummaryGrayLight,
     coltitle=black,
     %?
     fonttitle=\bfseries\sffamily,
     fontupper=\sffamily,
     %
     boxed title style={
         colback=SummaryGray,
     },
     overlay unbroken and first={
      \node[below right,font=\small,color=SummaryAccent,text width=.8\linewidth]
         at (title.north east) {#1};
     }
    }
   %========
   % 3.2.11 Observacion
       \newtcolorbox{remark}[1][]{
        arc=4pt, % Esquinas redondeadas con radio de 4pt
        title={\raisebox{-.2ex}{\ding{43}}~\textbf{Remark}}, % Título con ícono y texto
        colframe=yellow!45!white, % Color del borde
        colback=yellow!45!white,  % Color de fondo
        coltitle=blue,            % Color del texto del título
        fontupper=\sffamily,      % Fuente del contenido dentro del cuadro
        boxed title style={       % Estilo del recuadro del título
            colback=yellow!45!white, % Fondo del recuadro del título
            boxsep=1ex,              % Espaciado interno del recuadro
            arc=4pt                  % Esquinas redondeadas del título
        },
        overlay unbroken and first={ % Contenido adicional que se superpone
            \node[below right,font=\normalsize,color=red,text width=.8\linewidth]
            at (title.north east) {#1}; % Inserta el argumento opcional como nota en esquina superior derecha
        }
       }
   
   %========
   % 3.2.12 Nota
      \newtcolorbox{note}[1][]{
       arc=4pt, % Esquinas redondeadas
       title={\raisebox{-.2ex}{\ding{45}}~\textbf{Note}}, % Título con ícono y texto
       colframe=yellow!45!white, % Borde del cuadro
       colback=yellow!45!white,  % Fondo del cuadro
       coltitle=blue,            % Color del título
       %fonttitle=\bfseries\sffamily, % Fuente del título
       %fontupper=\frfamily,          % Fuente del contenido dentro del cuadro
       boxed title style={           % Estilo del recuadro del título
           colback=yellow!45!white,  % Fondo del recuadro del título
           boxsep=1ex,               % Espaciado interno
           arc=4pt                   % Esquinas redondeadas
       },
       overlay unbroken and first={ % Nota opcional alineada a la derecha del título
           \node[below right,font=\normalsize,color=red,text width=.8\linewidth]
           at (title.north east) {#1};
       }
     }
   
   %========
   % 3.2.13 Advertencia
    \newtcolorbox{warnbox}[1][]{
     arc=4pt,
     title={\textbf{Advertencia}},
     colframe=WarningOrangeDark,
     colback=WarningOrangeLight,
     coltitle=black,
     fonttitle=\bfseries\sffamily,
     fontupper=\sffamily,
     boxed title style={
         colback=WarningOrange,
     },
     overlay unbroken and first={
      \node[below right,font=\small,color=WarningAccent,text width=.8\linewidth]
         at (title.north east) {#1};
     }
    }
   %=======
   % 3.2.8 Textbox
     \newtcolorbox{textbox}[1][]{
      arc=4pt,
      colframe=colframe1,
      colback=colback1,
      coltext=Text,
      enhanced,
      overlay unbroken and first={
          \node[below right,font=\small,color=GeneralityAccent,text width=.8\linewidth]
          at (frame.north east) {#1};
      }
     }




% ============================================================
% 3-Documento
  % Apariencia general del documento
    \pagecolor{Backdoc}               % Color de fondo del documento
    \color{Text}                      % Color del texto
  
  % Espaciado y formato de párrafos
    \setlength{\parskip}{5pt}         % Espacio vertical entre párrafos
    \setlength{\parindent}{10pt}      % Sangría al inicio de párrafos
  
  % Espaciado en elementos flotantes (figuras, tablas)
    \setlength{\intextsep}{4pt}       % Espacio entre texto y floats insertados en el texto
    \setlength{\textfloatsep}{6pt}    % Espacio entre texto y floats en parte superior/inferior
    \setlength{\floatsep}{4pt}        % Espacio entre dos floats consecutivos
  
  % Opciones del paquete/clase
    \DeclareOption*{\PassOptionsToClass{\CurrentOption}{book}} % Pasa opciones no reconocidas a la clase base 'book'
    \ProcessOptions\relax            % Procesa las opciones pasadas al paquete
   

  
% ============================================================
% 4-Toc/indice
  % ==============================
  % Personalización del índice (Tabla de Contenidos)

    % ===============
    % Color para el texto de capítulos en el índice
      \newcommand{\tocchaptercolor}{Text}
    % ===============
    % Redefine el formato de las entradas de capítulo en el índice
      \def\l@chapter#1#2{
        \ifnum \c@tocdepth >\m@ne
          \addpenalty{-\@highpenalty}
          \addvspace{1.0em}
          \setlength\@tempdima{1.5em}
          \begingroup
            \parindent \z@
            \rightskip \@pnumwidth
            \parfillskip -\@pnumwidth
            \leavevmode
            \bfseries\sffamily
            \advance\leftskip\@tempdima
            \hskip -\leftskip
            \textcolor{\tocchaptercolor}{\chaptername~#1}\nobreak\hfil
            \nobreak\hb@xt@\@pnumwidth{\hss\color{\tocchaptercolor}#2}\par
            \penalty\@highpenalty
          \endgroup
        \fi
      }
    
  % =============================================================
  % Ajustes generales del índice
    % ===============
    % Ancho reservado para los números de página
      \def\@pnumwidth{6ex}
    % ===============
    % Separación entre puntos de líneas punteadas
      \def\@dotsep{.3}
    % ===============
    % Formato general de líneas punteadas para entradas del índice
      \def\@dottedtocline#1#2#3#4#5{
        \ifnum #1>\c@tocdepth \else
          \vskip \z@ \@plus.2\p@
          {
            \leftskip #2\relax
            \rightskip \@tocrmarg
            \parfillskip -\rightskip
            \parindent #2\relax
            \@afterindenttrue
            \interlinepenalty\@M
            \leavevmode
            \@tempdima #3\relax
            \advance\leftskip \@tempdima
            \null\nobreak\hskip -\leftskip
            \color{Text}\bfseries\sffamily #4\nobreak
            \leaders\hbox{$\m@th\mkern \@dotsep mu\hbox{.}\mkern \@dotsep mu$}\hfill
            \nobreak
            \hb@xt@\@pnumwidth{\hfil\normalfont\color{Text}#5}
            \par
          }
        \fi
      }
    
  
    % ===============
    % Nivel de numeración de secciones (hasta subsubsection)
      \setcounter{secnumdepth}{3}
    % ===============
    % Profundidad del índice (capítulos y secciones)
      \setcounter{tocdepth}{2}
    % ===============
    % Título del índice
      \renewcommand{\contentsname}{Índice}
    % ===============
    % Líneas punteadas en entradas del índice
      \renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
    % ===============
    % Espacios alrededor del título del índice
      \setlength{\cftbeforetoctitleskip}{0pt}
      \setlength{\cftaftertoctitleskip}{10pt}
    % ===============
    % Espacio antes de entradas de secciones
      \setlength{\cftbeforesecskip}{5pt}

% ============================================================
% 5-Formato visual del títulos(colores definidos arriba)
    % ===============
    % Parte
      \newcommand{\CustomPartFormat}[1]{%
      \vspace{2ex}
      \begin{center}
        \begin{tikzpicture}[remember picture, overlay, every node/.style={font=\Huge\bfseries\sffamily, align=center, text width=0.8\linewidth}]
          \node[
            rounded corners=2pt,
            minimum height=6ex,
            draw=Partcolor,
            fill=Partcolor,
            text=white,
            line width=1pt,
            anchor=center
          ] at ([yshift=-5cm]current page.north) {#1};
        \end{tikzpicture}%
      \end{center}
      \vspace{5ex}
      }
      % ====================
        \titleformat{\part}[display]
        {\normalfont\Huge\bfseries}  % tamaño y estilo destacado
        {}                            % sin número o etiqueta adicional
        {0pt}                         % sin separación con el contenido
        {\CustomPartFormat}          % formato personalizado
      \titlespacing*{\part}{0pt}{10pt}{10pt}  % sangría, antes, después

  
    % ===============
    % Capítulo
      \newcommand{\CustomChapterFormat}[1]{%
      \vspace{2ex} % Espacio vertical antes del título del capítulo
      \begin{tikzpicture}[overlay, remember picture] % Dibujo sobre la página actual
        \node[
          anchor=north west,                % Ancla la esquina superior izquierda
          rounded corners=2pt,             % Bordes redondeados
          minimum height=6ex,              % Altura mínima del recuadro
          draw=Chaptercolor,               % Borde del recuadro (mismo color que el relleno)
          fill=Chaptercolor,               % Color de fondo del recuadro
          text=white,                      % Color del texto
          line width=1pt,                  % Grosor del borde
          font=\LARGE\bfseries\sffamily,   % Fuente: grande, negrita y sans-serif
          text width=0.9\paperwidth,       % Ancho del texto (90% del ancho del papel)
          align=left                       % Alineación del texto a la izquierda
        ] at ([yshift=-1.5cm]current page.north west)  % Posición del nodo (2 cm debajo de la parte superior)
        {\chaptername~\thechapter\quad #1};          % Contenido del nodo: "Capítulo N Título"
    
        % Línea decorativa horizontal (eliminada/comentada):
        % \draw[very thick, color=Chaptercolor]
        %   ([xshift=0.3mm, yshift=-0.3mm]current page.north west)
        %   -- ([xshift=0.9\paperwidth]current page.north west);
    
      \end{tikzpicture}
      \vspace{-2ex} % Espacio vertical después del título
      }
  
        % ====================
        
        \titleformat{\chapter}[display]
        {\normalfont\huge\bfseries}
        {}                            
        {0pt}                         
        {\CustomChapterFormat}
      \titlespacing*{\chapter}{0pt}{0pt}{0pt}
    % ===============
    % Capítulo*
      \newcommand{\CustomUnnumberedChapterFormat}[1]{
        \vspace{2ex}
        \begin{tikzpicture}[overlay, every node/.style={font=\large\bfseries\sffamily}]
          \node[
            right,
            rounded corners=2pt,
            minimum height=5ex,
            draw=*chaptercolor,
            fill=*chaptercolor,
            text=white,
            line width=1pt,
            text width=\linewidth-2em,
            align=left
          ] at (0,0) {#1};
        \end{tikzpicture}
        \vspace{4ex}
      }
      % ====================
      
      \titleformat{name=\chapter,numberless}[display]
      {\normalfont\huge\bfseries}
      {}                            
      {0pt}                         
      {\CustomUnnumberedChapterFormat}
      \titlespacing*{\chapter}{0pt}{10pt}{10pt}
    % ===============
    % Sección
     \newcommand{\CustomSectionFormat}[1]{%
       \vspace{2ex}
       \begin{tikzpicture}[overlay, every node/.style={font=\normalsize\bfseries\sffamily, text=white, align=left}]
         \node[
           rounded corners=2pt,
           draw=Sectioncolor,
           fill=Sectioncolor,
           line width=1pt,
           inner xsep=0.5em,
           inner ysep=0.4em,
           anchor=west
         ] at (0,0) {\thesection\quad#1};
       \end{tikzpicture}
       \vspace{1ex}
     }
     % ====================
     % Sección
     \titleformat{\section}[block]
     {\normalfont\Large\bfseries}
     {}                            
     {0pt}                         
     {\CustomSectionFormat}
     \titlespacing*{\section}{0pt}{18pt}{-8pt}
 

    % ===============
    % Subsección
      \newcommand{\CustomSubsectionFormat}[1]{
        \vspace{2ex}
        \begin{tikzpicture}[every node/.style={font=\small\bfseries\sffamily, align=left}]
          \node[
            rounded corners=2pt,
            draw=Subsectioncolor,
            fill=Subsectioncolor,
            text=white,
            line width=1pt,
            inner xsep=0.6em,
            inner ysep=0.4em
          ] {#1};
        \end{tikzpicture}
        \vspace{1ex}
      }
      % ====================
      % Subsección
      \titleformat{\subsection}[block]
      {\normalfont\large\bfseries}
      {}                            
      {0pt}                         
      {\CustomSubsectionFormat}
      \titlespacing*{\subsection}{0pt}{10pt}{-15pt}

    % ===============
    % Subsubsección
     \newcommand{\CustomSubsubsectionFormat}[1]{
       \vspace{1.5ex}
       \begin{tikzpicture}[overlay, every node/.style={font=\footnotesize\bfseries\sffamily}]
         \node[
           right,
           rounded corners=2pt,
           minimum height=2.5ex,
           draw=Subsubsectioncolor,
           fill=Subsubsectioncolor,
           text=white,
           line width=0.8pt,
           inner xsep=1ex,
           inner ysep=0.5ex
         ] at (0,0) {#1};
       \end{tikzpicture}
       \vspace{2ex}
     }
     % ====================
     \titleformat{\subsubsection}[block]
     {\normalfont\normalsize\bfseries}
     {}                            
     {0pt}                         
     {\CustomSubsubsectionFormat}
     \titlespacing*{\subsubsection}{-2pt}{15pt}{-23pt}

  
    % ===============

% ============================================================
% 6-hipervinculos
  % Configuración general de hipervínculos con hyperref

  \hypersetup{ 
    linktoc=all,             % Hace que tanto los títulos como los números en el índice sean hipervínculos
    bookmarksnumbered,       % Añade numeración a los marcadores del PDF
    bookmarksopen,           % Expande los marcadores al abrir el PDF
    %hidelinks,               % Oculta recuadro de los enlaces
    colorlinks=true,
    linkcolor=linkcolor1,
    urlcolor=urlcolor1,
    citecolor=citecolor1
    }
  
  % Configuración específica de marcadores (bookmarks) en el PDF
  \bookmarksetup{
    addtohook={                         % Hook que se ejecuta al agregar cada marcador
      \ifnum\bookmarkget{level}=0       
        \bookmarksetup{color=red}       
      \fi
      \ifnum\bookmarkget{level}=1       
        \bookmarksetup{color=green}
      \fi
      \ifnum\bookmarkget{level}=2      
        \bookmarksetup{color=purple}
      \fi
    }
  }

% ============================================================
% 7-Captions figuras y Tablas
  
  % Define una fuente personalizada para los captions (títulos de figuras/tablas)
  \DeclareCaptionFont{custom}{\color{Text}\sffamily}
  % ==============================
  % Configuración general de captions
    \captionsetup{
      font=small,             % Tamaño de fuente del caption
      skip=4pt,               % Espacio entre el caption y el objeto (figura/tabla)
      labelfont=custom,       % Fuente para la etiqueta (por ejemplo, "Figura 1")
      textfont=custom,        % Fuente para el texto del caption
      labelsep=colon          % Separador entre etiqueta y texto (usa ":")
    }
  % ==============================
  % Configuración específica para subfiguras/subtablas
  
    \captionsetup[sub]{
      font=footnotesize,      % Tamaño más pequeño para captions de subfiguras
      skip=2pt,               % Menor separación entre caption y objeto
      labelfont=custom,       % Misma fuente personalizada
      textfont=custom,
      labelsep=colon
    }
  
% ============================================================
% 8-Matemáticas

  % Permitir saltos de página en entornos de ecuación
  \allowdisplaybreaks[2]  % Nivel 2 = moderado

% ============================================================
% 9-Encabezados y Pies de página
  % Activar estilo fancy y limpiar encabezados/pies
  \pagestyle{fancy}
  \fancyhf{}

  % ==============================
  % Encabezado

    % Muestra el nombre del capítulo en páginas pares e impares
    \fancyhead[LO]{\textcolor{Text}{\footnotesize\itshape\leftmark}} % Página impar (izquierda)
    \fancyhead[RE]{\textcolor{Text}{\footnotesize\itshape\leftmark}} % Página par (derecha)
    
    % Actualiza el valor de \leftmark con capítulo + título
    \renewcommand{\chaptermark}[1]{\markboth{\thechapter\quad #1}{}}
  
  % ==============================
  % Pie de página
    % ===============
    % Número de página centrado, dentro de recuadro con estilo
      \fancyfoot[C]{%
        \tikz[baseline=-0.8ex]{%
          \node[
            sharp corners,
            inner sep=3pt,
            fill=Chaptercolor,
            text=white,
            font=\normalsize\bfseries\sffamily,
            text width=4ex,
            align=center
          ]{\thepage};
        }
      }
    % ===============
    % Frases personalizadas en esquinas inferiores
      \fancyfoot[LO]{\textcolor{Text}{\footnotesize\itshape Frase izquierda}}  % Página impar
      \fancyfoot[RE]{\textcolor{Text}{\footnotesize\itshape Frase derecha}}   % Página par
    
    % ===============
    % Formato de notas al pie
      % =======
      % Línea horizontal antes de las notas al pie
        \renewcommand{\footnoterule}{%
          \kern -3pt
          \textcolor{blue}{\hrule width \linewidth height 0.4pt}
          \kern 2.6pt
        }
      % =======
      % Formato del número de nota al pie: negrita, sans serif, negro, entre paréntesis
        \def\thefootnote{\color{Text}\bfseries\sffamily(\arabic{footnote})}
      % =======
      % Tamaño de letra para footnotes
        \renewcommand{\footnotesize}{\small}
      % =======
      % Evita reiniciar numeración de notas por capítulo
        \counterwithout{footnote}{chapter}
  
% ============================================================
% 10-Codigo(usa colorbox, colores de codigo definidos aqui)
  % Colores codigo(Se repiten en diferentes lenguajes, por comodidad al definir un nuevo lenguaje lo dejo aqui)
    \definecolor{bashcmd}{RGB}{80, 150, 80}        % Comandos resaltados en listings (sudo, apt, etc.)
    \definecolor{bashbg}{RGB}{48, 10, 36}            % Fondo del tcolorbox
    \definecolor{bashbg1}{RGB}{25, 30, 45}           % Fondo del bloque de código listings
    \definecolor{SolutionAccent}{RGB}{233,196,106}  % Color del texto flotante a la derecha del título del tcolorbox
    \definecolor{bashtext}{RGB}{212,212,212}         % Color del texto base en listings
    \definecolor{grisDark}{RGB}{50,50,50}            % Fondo del título del tcolorbox
    \definecolor{grisLight}{RGB}{230,230,230}        % Color del texto del título del tcolorbox
    
  
  % ============================================================
  % Estilos de código
      % ==============================  
      % bash(color debian)
        \lstdefinestyle{bashstyle}{
        literate={\$}{{{\color{bashcmd}\$}}}1,     % Resalta el símbolo "$" del prompt en color bashcmd
        backgroundcolor=\color{bashbg1},           % Establece el color de fondo del bloque de código
        basicstyle=\ttfamily\small\color{bashtext},% fuente monoespaciada, tamaño pequeño y color del texto base
        keywordstyle=\color{bashcmd}\bfseries,     % Estilo para palabras clave
        language=bash,                             % Lenguaje para el resaltado sintáctico (bash)
        breaklines=true,                           % Líneas largas se dividan automáticamente
        showstringspaces=false,                    % Evita mostrar espacios como caracteres visibles en cadenas
        morekeywords={sudo,apt,cd,ls,mkdir},       % Añade palabras clave
        }
      % ==============================
      % bash2(color ubuntu)
        \lstdefinestyle{bashstyle2}{
        literate={\$}{{{\color{bashcmd}\$}}}1,     % Resalta el símbolo "$" del prompt en color bashcmd
        backgroundcolor=\color{bashbg},           % Establece el color de fondo del bloque de código
        basicstyle=\ttfamily\small\color{bashtext},% fuente monoespaciada, tamaño pequeño y color del texto base
        keywordstyle=\color{bashcmd}\bfseries,     % Estilo para palabras clave
        language=bash,                             % Lenguaje para el resaltado sintáctico (bash)
        breaklines=true,                           % Líneas largas se dividan automáticamente
        showstringspaces=false,                    % Evita mostrar espacios como caracteres visibles en cadenas
        morekeywords={sudo,apt,cd,ls,mkdir},       % Añade palabras clave
        }
      % ==============================
      % Latex
        \lstdefinestyle{latexstyle}{
        backgroundcolor=\color{bashbg1},               % Usa el mismo fondo que bashstyle2
        basicstyle=\ttfamily\small\color{bashtext},   % Fuente, tamaño y color base
        keywordstyle=\color{bashcmd}\bfseries,        % Color de comandos LaTeX
        language=[LaTeX]TeX,                           % Lenguaje LaTeX
        breaklines=true,                              % Romper líneas largas
        showstringspaces=false,                       % No mostrar espacios en cadenas
        morekeywords={documentclass,usepackage,begin,end,textbf,textit,section,subsection,maketitle}, % Comandos LaTeX adicionales
        }
      % ==============================
  
      
  
  % ============================================================
  % Cajas de codigo
    % ==============================
    % Debian
      \newtcolorbox{Debianbox}[1][]{
      title={ bash}, % título alineado a la izquierda
      colback=bashbg1,                     % color fondo caja
      colframe=grisDark,                % color borde caja
      coltitle=grisLight,       % color título
      boxed title style={                 % estilo del título
      colback=grisDark,       % fondo título
      boxrule=0pt,                      % borde en título
      left= 0pt, right=529pt,            % margen horizontal en título
      height=1.2em,                     % altura fija título
      valign=center                     % texto centrado verticalmente
      },
      arc=4pt,                           % esquinas redondeadas
      fonttitle=\bfseries,               % título en negrita(grosor)
      overlay unbroken and first={       % nodo extra en esquina título
      \node[below right,font=\small,color=SolutionAccent,text width=.8\linewidth]
      at (title.north east) {#1};
      },
      enhanced,                         % mejoras gráficas
      boxsep=2pt,                       % separación interna caja
      left=-2pt, right=-2pt, top=-6pt, bottom=-5.5pt, % márgenes internos
      before upper={\setlength{\parskip}{2pt}}, % espacio entre párrafos
      before skip=4pt, after skip=4pt  % espacio antes y después caja
      }
    % ==============================
    % Ubuntu
      \newtcolorbox{Ubuntubox}[1][]{
      title={bash},
      colback=bashbg,
      colframe=grisDark,
      coltitle=grisLight,
      boxed title style={
      colback=grisDark,
      boxrule=0pt,
      left=0pt, right=529pt,
      height=1.2em,
      valign=center
      },
      arc=4pt,
      fonttitle=\bfseries,
      overlay unbroken and first={
      \node[below right,font=\small,color=SolutionAccent,text width=.8\linewidth]
      at (title.north east) {#1};
      },
      enhanced,
      boxsep=2pt,
      left=-2pt, right=-2pt, top=-6pt, bottom=-5.5pt,
      before upper={\setlength{\parskip}{2pt}},
      before skip=4pt, after skip=4pt
      }

% =============================================================
% 11-Bibliografía
  
  \DeclareLanguageMapping{spanish}{spanish-apa}
  \DefineBibliographyExtras{spanish}{%
    \protected\def\mkbibnamefamily#1{\textsc{#1}} % Apellidos en versalitas
  }
% =============================================================
% 12-Contraportada
  
  \renewcommand{\maketitle}{%
    \begin{center}
      \today
    \end{center}
  }
% =============================================================
% 12-Comandos Definidos
  \newcommand{\nochaptername}[1]{\textcolor{\tocchaptercolor}{#1}}%Para capitulos en indice
% =============================================================